name: Resolve which editions should build
inputs:
  scope:
    description: Include `test` sh files like assert.sh , otherwise, only standard utils
    type: boolean
    options:
      - test
      - run
    required: false
    default: 'run'
  export-files:
    description: Copies utils files to temp 'outputs.folder'
    type: boolean
    required: false
    default: 'true'
outputs:
  sources:
    value: ${{ steps.export-scripts.outputs.export-sources }}
  folder:
    value: ${{ steps.export-scripts.outputs.export-folder }}
  path:
    value: ${{ steps.export-scripts.outputs.export-path }}

runs:
  using: "composite"
  steps:
    - shell: bash
      id: export-scripts
      run: |
        UTIL_SCRIPTS="${{ github.action_path }}/scripts"

        if [[ "${{ inputs.scope }}" == "test" ]]; then
          curl --silent https://raw.githubusercontent.com/hazelcast/assert.sh/main/assert.sh > "${UTIL_SCRIPTS}/assert.sh"
        fi

        # Read contents and add newline end of each file. Courtesy of https://unix.stackexchange.com/a/628618
        CAT_SORUCES=$(sed -s -e '${p;g;}' ${UTIL_SCRIPTS}/*.sh)
        CAT_SORUCES+=$'\n'
        #echo "export-sources<<EOF"$'\n'"$CAT_SORUCES"$'\n'EOF >> ${GITHUB_OUTPUT}

        echo 'export-sources<<EOF' >> $GITHUB_OUTPUT
        echo "$CAT_SORUCES" >> $GITHUB_OUTPUT
        echo 'EOF' >> $GITHUB_OUTPUT

        if [[ "${{ inputs.export-files }}" == 'true' ]]; then
          TEMP_FOLDER=$(mktemp -d)
          find "${UTIL_SCRIPTS}" -name "*.sh" -type f -print0 | xargs -0 cp -t "${TEMP_FOLDER}"
          echo "export-folder=${TEMP_FOLDER}" >> ${GITHUB_OUTPUT}
          echo "export-path=${TEMP_FOLDER}:$PATH" >> ${GITHUB_OUTPUT}
        fi